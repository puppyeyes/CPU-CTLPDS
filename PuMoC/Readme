This archive contains the source code for the model-checker PuMoC.
Some of the source code is taken from the model-checker Moped. All the rights
of these source code belong to Moped.

PuMoC is a combined CTL, LTL and reachability checker for pushdown systems. 
The novel feature of PuMoC is that PuMoC can check CTL specification with 
regular valuations. PuMoC can handle pushdown systems in the following 
two forms: (a) pushdown systems can be processed by Moped; (b) pushdown systems
generated by JimpletoPDSolver. 
 
Roughly speaking, the expressive power of pushdown systems is equivalent
to that of programs with (possibly recursive) procedures where all variables
have a finite data type. PuMoC can also process Boolean Programs generated
by SLAM and Satabs except the concurrent instructions.

This document will tell you how to compile the checker (see the sections
"Prerequisites" and "Building"), and how to use it (see the "Usage" and
"Input formats" section). If you plan to use Moped within the Slam toolkit,
see also the "Moped and Boolean programs" section at the end of the file.


** Prerequisites **

To compile, you will need the CUDD library by Fabio Somenzi.
CUDD can be found here:
	http://vlsi.colorado.edu/~fabio/


To use LTL and reachability model checking, PuMoC uses Moped to solve these
problem. Thus, you will need an executable of Spin
(which Moped uses to translate LTL formulae into Buechi automata).
Pointers to Spin downloads can be found here:
	http://netlib.bell-labs.com/netlib/spin/whatispin.html

PuMoC will look for Spin in the following directories (in this order):
the directory specified in the SPINDIR environment variable, the directory
that PuMoC itself is in, or any directory listed in the PATH variable.
If you are in doubt which executable PuMoC is using, use PuMoC with the
-s3 option.

To CTL model checking C programs, PuMoC can interact with Satabs and SLAM.
You will need to install satabs or slam first. Then, use satabs or slam translate
C programs to the boolean programs. Finally, you can do model checking for the result
boolean programs. 
Satabs can be found here:
	http://www.cprover.org/satabs/
	
SLAM can be found here:
	http://research.microsoft.com/en-us/projects/slam/

** Building **

To build on a Linux machine or Windows machine with Cygwin, first edit the Makefile and adjust the
path to the CUDD library files in the first few lines. Then "make"
should build the PuMoC binary. 

The code has been compiled and run under both Linux gcc and Cygwin gcc 
and tested with CUDD versions 2.4.4.


** Usage **

The usage of the checker is as follows:

	PuMoC <modelfile> [formula] [-<options>]

<modelfile> should be either 
  (1) an alternating Buechi pushdown system (see the .abpds files in test) with
      the  -l2 option and do not input the [formula].
  (2) a pushdown system (see the .pds files in test).  
  (3) a boolean program (see the .bp files in the test). To use boolean programs, use the -b option.

<formula> is either an 
  (1) blank for checking emptiness of an alternating Buechi pushdown system.
  (2) LTL formula (in Spin's syntax) with the -l0 option.
  (3) reachability formula with the -r option. 
      For pushdown systems, a reachability formula has the form state:stacksymbol, 
      for boolean programs, it is simply a label within the program.
  (4) A CTL formula (see the .ctl files in test) with the -l1 option.
  (5) A file name containing a LTL formula, a reachability formula or a CTL formula with the -f option.

Note that regular valuations are represented by regular expressions parenthesized by sharp #.

The options of PuMoC are as follows:
 
-a: Enable automatic variable reordering within the CUDD routines.
    It is not normally recommended to use this since the reorderings
    take very long. Use -aa to enable auto-reordering only during
    the phase when the modelfile is read and the pushdown system built,
    and disable it during the actual model-checking.
    See also the -m options. This option is inherited from Moped.

-b: Take a boolean program as input (default is pushdown system or alternating Buechi pushdown system with the -l2 option).
    

-c: Choose method for finding repeating heads and is inherited from Moped. Useless for CTL 
    Model-checking.
    -cT: Preprocess by removing trivially irreversible transitions (default).
    -cN: Do not remove trivially irreversible transitions.
    -cC: Compute cycles with transitive closure method.
    -cE: Compute cycles with Emerson-Lei method.
    -cO: Compute cycles with OWCTY method (default).
    -cX: Compute cycles with Xie-Beerel method.
    Multiple letters can be combined as in, e.g., -cEN.

-e0,-e1: are inherited from Moped. Moped has two slightly different encodings for Boolean Programs into
    pushdown systems. Encoding 0 is the default, encoding 1 works faster with
    backwards reachability checks (-pB); however, forward reachability works
    faster in most cases anyway.

-f: Normally, PuMoC translates the negation of <formula> into a Buechi automaton
    using Spin. If this option is used, Moped will interpret <formula> as the
    name of a file that contains a Buechi automaton, and will use this instead.
    The file should be produced by Spin, or at least its syntax should be
    compatible with that of Spin. In case of CTL model checking, with the -f option,
    PuMoC will read the CTL formula from the file <formula>.

-D: Can be used to override `define'd values in pushdown systems; e.g. in the
    quicksort_error example use -DN=4 or -DN=5 to set N to different values. This
    option is useful only for LTL/reachability model checking.

-m0,-m1,-m2: Set various variable orderings. For pushdown systems,
    -m0 or -m1 are recommended (-m0 is default). For boolean programs,
    -m2 (default) is recommended. This option is useful only for LTL/reachability model checking.

-o: Dead variable elimination and mod/ref analysis (useful only for
    Boolean Programs, otherwise ignored).
    -o0: Do not use any optimizations (default).
    -o1: Perform a mod/ref analysis on the global variables.
    -o2: Perform a full ``live range'' analysis for all local variables.
    -o3: Use both optimizations (equivalent to just -o).
    Do not use -o together with trace generation for Newton or XML.
    This option is useful only for LTL/reachability model checking.

-p: The checker has two different algorithms, one of them works with backward
    search (pre*), the other with forward search (post*). Using the post*
    method is the default as it is faster on most examples. Also, the search
    can be exhaustive (computes all reachable states) or "demand-driven"
    (stops as soon as the yes/no result is known).
    -pF: search forwards (use post*), formerly -p1 or -p2 (default)
    -pB: search backwards (use pre*), formerly -p0
    -pE: exhaustive search, formerly -p0 or -p1
    -pD: "demand" search, quit when result known, formerly -p2; (default)
	 this option is effective for both types of reachability queries;
	 for LTL queries it is effective only for forward search.
    Multiple letters can be combined as in, e.g., -pFD.
    This option is useful only for LTL/reachability model checking.

-q0, -q1: Use depth-first (-q0, default) or breadth-first (-q1) queueing
    strategy for worklist when computing reachability.
    This option is useful only for LTL/reachability model checking.

-r: Check for reachability instead of LTL/CTL. See above for format of
    reachability formulas. Moped can also print the automaton which
    represents the reachable configurations
	-r or -r0: check reachability only, do not print automaton
	-r1: print the reachable state automaton without BDDs
	-r2: print the BDDs, too, but without stack contents
	-r3: print the complete BDDs
	This option is useful only for LTL/reachability model checking.

-s0 ... -s3: Set verbosity level.
    -s0: silent; output only a YES/NO answer and a trace, if applicable.
    -s1: additionally print progress and timing reports (default).
    -s2: additionally print BDD statistics at the end.
    -s3 and higher: for debugging purposes.
    This option is useful only for LTL/reachability model checking.

-t: Output a counterexample (LTL) or a trace to the error label (reachability).
    -tP outputs a trace of the pushdown system.
    -tN outputs a newton style trace.
    -tX outputs an XML trace.
   

-v0 ... -v2: This determines how BDD variables are related to variables in
    the pushdown system/boolean program. -v0 (default for pushdown systems)
    minimizes the number of BDD variables (ok for small programs). -v1 assigns
    one BDD variable to each program variable (like in bebop). -v2 (default for
    boolean programs) allocates one BDD variable per different variable name.
    This option is useful only for LTL/reachability model checking.

-l: Specify the type of model checking.
    -l0: LTL model checking
    -l1: CTL model checking
    -l2: Emptiness problem of alternating Buechi pushdown system. 
    

** Input formats **

For pushdown systems, PuMoC can process two syntax of pushdown systems,

	(1) one is inherited from Moped, the supplied examples in /PuMoC/examples 
	   	will give you an idea of the syntax. In general, the files start with the 
			defines (see the -D option), then the variable declarations (globals, locals), 
			then the initial configuration (restricted to stack of length one), 
			and finally the pushdown rules. The right-hand side of the rules has length 
			at most 2. Variable relations (which are translated into a BDD can be added 
			in parentheses; here unprimed names refer to the left-hand side of the rule, 
			singly primed names to the right hand side control location and the first stack 
			symbol, and doubly primed names to the second stack symbol (if there is one).
			 
  (2) The second is the syntax of the pushdown system generated by JimpletoPDSolver 
      which translates Java programs to pushdown systems with def/use information. 

	The parser is not very robust and might output confusing error messages at times - sorry about that.


For Boolean Programs, see the information provided at the Satabs/SLAM homepage.







** History **
10.10.2011: Version 1.0.0, initial release.


The following is the history of Moped.
17.01.2002: Version 1.0.0, initial release
11.02.2002: Version 1.0.1, fixed spin executable required in current directory
11.02.2002: Version 1.0.2, fixed problem with using labels in a BP as predicates
				in an LTL formula
12.03.2002: Version 1.0.3, fixed a bug in error trace generation
09.04.2002: Minor changes to witness generation code
18.06.2002: Overhaul of the options:
		-s, -v, -y combined to -s<n>
		-e, -g, -o combined to -o<n>
		made -p2 default
		-V renamed to -v
		changed -m3 to -m0, -m4 to -m1, -m7 to -m2, removed all others
		new methods for finding cycles and new syntax for options (-c)
	    Fixed bug in trace generation for LTL (reported by Reid Simmons)
            New, Windows-compatible Makefile thanks to Jakob Lichtenberg
29.07.2002: Expanded -r switch, see above
07.08.2002: Added properties over variables
	    removed -F option
07.10.2002: Added enforce condition of main function in a boolean program to
		the initial condition (thanks Roderick Bloem for the bug report)
	    Version 1.0.7 released
07.03.2003: Improved backward reachability queries, -p option changed, see above
	    Added a different encoding for Boolean Program, selectable by -e<n>
		(the new encoding makes backwards reachability faster).
	    Fixed a number of bugs thanks to David Melski's reports:
		* error in LTL checking when properties were single letters
		* fixed two more bugs in trace generation (yet again)
		* parsing problems for LTL formulas (operator priorities)
08.08.2003: Version 1.0.9: some bugfixes, and optimizations when building
		BDDs from expressions, thanks to Changhao Jiang for the reports
		New binary version for Cygwin
03.12.2003: Version 1.0.10: fixed a bug for some reachability examples,
		thanks to Bjorn H. Bjornsson for the report.
07.01.2004: Version 1.0.11: fixed a bug when using -r[123] (the checker would
		erroneously report NO instead of YES, thanks to Vinod Ganapathy
		for the report).
28.04.2004: Moped mistakenly refused to allow 0 as the lower bound of an
		array; fixed.
14.06.2004: Allowed "." in identifiers.
15.06.2004: Fixed division by zero error (reported by Dejvuth Suwimonteerabuth).
24.06.2004: Fixed a problem with the LTL parser
08.10.2004: Fixed a segfault when checking LTL on Boolean programs
		(reported by Swarat Chaudhuri).
18.10.2004: Put the option to use pre-computed Büchi automata back in, now -f
30.11.2004: Added curly brackets for integer expressions
11.01.2005: Fixed some BDD reference-counting bugs (reported by Pierre Ganty).
31.03.2005: Fixed a bug when printing rule labels (reported by Remy).
18.04.2005: Version 1.0.13 released
22.07.2008: Fixed a bug in bpSpecial.c (reported by Salvatore LaTorre).
06.11.2009: Added the atoms feature (see examples/atoms.pds),
		proposed by Dilian Gurov.
